---
import Layout from "../layouts/Layout.astro";
import CategoryCard from "../components/CategoryCard.astro";
import { fetchData } from "../services/fetchData";
import { type Product } from "../services/types";
import ProductCard from "../components/ProductCard.astro";
import InfoCard from "@/components/InfoCard.astro";
import Faq from "@/components/Faq";
import Chevron from "@/components/Icons/Chevron.astro";
import { categories } from "@/services/const";

const promotions = await fetchData("getAllProducts");
const BASE_URL = import.meta.env.AWS_CLOUDFRONT_URL;
---

<Layout title="Bienvenido a VIGI | Tienda Online de articulos de seguridad para el hogar">
  <div class="hidden w-auto sm:flex">
    <img class="w-full object-cover" src="/carrusel1.png" alt="pricipal_banner">
  </div>
  <main class="px-4 pb-4 sm:px-8 sm:pb-8 max-w-[1180px] m-auto">
    <div class="my-10 sm:py-5 sm:hidden sm:w-[550px] lg:w-[600px] 2xl:w-[750px]">
      <h1 class="text-primary font-bold my-1 text-xl sm:text-4xl 2xl:text-5xl">
        Tienda online. <span class="text-black font-normal"
          >Compra seguro tus artículos de seguridad.</span
        >
      </h1>
    </div>
    
    <section
      class="grid grid-cols-2 place-items-center gap-5 sm:grid-cols-4 xl:grid-cols-8 sm:mt-16 sm:mb-10"
    >
    {
      categories.map(c => {
        return (
          <CategoryCard
            image_path={`${BASE_URL}/categories/${c.path}.png`}
            title={c.name}
          />
        )
      })
    }
    </section>

    <div class="my-2 sm:py-5 sm:w-[550px] lg:w-[600px] 2xl:w-[750px]">
      <h2
        class="text-primary font-bold my-10 text-base sm:text-2xl 2xl:text-3xl"
      >
        Destacados. <span class="text-black font-normal">
          El mejor precio por el mejor producto.</span
        >
      </h2>
    </div>

    <section class="relative">
      <div class="flex gap-5 mb-16 overflow-x-hidden">
        <div id="promotions_slider" class="flex gap-5 mb-16 py-4 transition-transform duration-1000 ease-out translate-x-0" data-items={promotions.length}>
          {
            promotions.map((product: Product) => (
            <ProductCard product={product}/>
          ))
        }
      </div>
      <button id="prev" class="absolute top-1/3 left-0 sm:-left-7 bg-violet-100 hover:shadow-2xl hover:scale-110 transition-transform duration-700 rounded-full p-2"><Chevron rotate={true}/></button>
      <button id="next" class="absolute top-1/3 right-0 sm:-right-7 bg-violet-100 hover:shadow-2xl hover:scale-110 transition-transform duration-700 rounded-full p-2"><Chevron/></button>
    </div>
  </section>
    
    <section class="w-full grid grid-cols-1 sm:grid-cols-3 place-items-center gap-x-2 my-24">
      <InfoCard icon="truck" title="Envíos a todo el país" description="Gratis a partir de 200,000" />
      <InfoCard icon="card" title="Todos los medios de pago" description="Descuentos en efectivo" />
      <InfoCard icon="mail" title="Seguimiento de tu compra" description="Elige cualquier medio" />
    </section>
  </main>

  <div class="banner flex flex-col justify-center items-start">
    <div class="w-full flex justify-between p-4 sm:p-8 max-w-[1180px] m-auto">
      <h5 class="text-white sm:text-2xl text-balance">Hoy, tu seguridad al alcance de tus manos.</h5>
    </div>
  </div>

  <section id="faq" class="p-4 sm:p-8 max-w-[1180px] m-auto">
    <div class="my-2 sm:py-5 sm:w-[550px] lg:w-[600px] 2xl:w-[750px] ">
      <h2
        class="text-primary font-bold my-10 text-base sm:text-2xl 2xl:text-3xl"
      >
       Preguntas frecuentes. <span class="text-black font-normal">
        Si necesitas ayuda adicional, puedes ponerte en contacto con soporte.</span
        >
      </h2>
    </div>
    <Faq client:visible />
  </section>
  <script>
    import { check } from "@/store/cartStore";

    const token = document.cookie.split('=');

    if(token != null){
      check.set(token[1])
    }

    //Carrousel Slider
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const slider = document.getElementById("promotions_slider");
    const arrItems = slider?.getAttribute("data-items");

    let current = 0;
    let translateXpercentage = current;

    const addOne = () => {
      if(arrItems != null){
        const total = parseInt(arrItems)
        if(!(current == total - 3)){
          current += 1;
        } 
      }
    };
    
    const removeOne = () => current >= 1 ? current -= 1 : null;
    const updatePercentaje = () => translateXpercentage = current * 3.7;
    
    const handlerClick = (e: any, action: number) => {
      e.preventDefault();
      action == 1 ? addOne() : removeOne();
      updatePercentaje();
      if(slider) slider.style.transform = `translateX(-${translateXpercentage}%)`;
    }

    prevBtn?.addEventListener('click', (e) => handlerClick(e,0));
    nextBtn?.addEventListener('click', (e) => handlerClick(e,1));
    //
  </script>
</Layout>


<style>
  .banner {
    background-image: url('/banner1.webp');
    background-size: cover;
    background-position: center;
    height: 300px;
    width: 100%;
  }
</style>
