---
import Layout from "../layouts/Layout.astro";
import CategoryCard from "../components/CategoryCard.astro";
import { fetchData } from "../services/fetchData";
import InfoCard from "@/components/InfoCard.astro";
import Faq from "@/components/Faq";
import { categories } from "@/services/const";
import CardsCarrusel from "@/components/CardsCarrusel.astro";

const promotions = await fetchData("getAllProducts");
const BASE_URL = import.meta.env.AWS_CLOUDFRONT_URL;
---

<Layout title="Bienvenido a VIGI | Tienda Online de artículos de seguridad para el hogar">
  <!-- BG FOR DESKTOP -->
  <div class="hidden w-auto sm:flex">
    <img class="w-full object-cover" src="/carrusel1.png" alt="pricipal_banner">
  </div>
  <!-- BG FOR MOBILE -->
  <main class="px-4 pb-4 sm:px-8 sm:pb-8 max-w-[1180px] m-auto">
    <div class="my-10 sm:py-5 sm:hidden sm:w-[550px] lg:w-[600px] 2xl:w-[750px]">
      <h1 class="text-primary font-bold my-1 text-xl sm:text-4xl 2xl:text-5xl">
        Tienda online. <span class="text-black font-normal"
          >Compra seguro tus artículos de seguridad.</span
        >
      </h1>
    </div>
    
    <!-- CATEGORIES -->
    <section class="grid grid-cols-2 place-items-center gap-5 sm:grid-cols-4 xl:grid-cols-8 sm:mt-16 sm:mb-10">
    {
      categories.map(c => {
        return (
          <CategoryCard
            image_path={`${BASE_URL}/categories/${c.path}.png`}
            title={c.name}
          />
        )
      })
    }
    </section>

    <div class="my-2 sm:py-5 sm:w-[550px] lg:w-[600px] 2xl:w-[750px]">
      <h2
        class="text-primary font-bold my-10 text-base sm:text-2xl 2xl:text-3xl"
      >
        Destacados. <span class="text-black font-normal">
          El mejor precio por el mejor producto.</span
        >
      </h2>
    </div>

    <!-- CARRUSEL -->
    <CardsCarrusel products={promotions}/>
    
    <!-- INFORMATIVES CARDS -->
    <section class="w-full grid grid-cols-1 sm:grid-cols-3 place-items-center gap-x-2 my-24">
      <InfoCard icon="truck" title="Envíos a todo el país" description="Gratis a partir de 200,000" />
      <InfoCard icon="card" title="Todos los medios de pago" description="Descuentos en efectivo" />
      <InfoCard icon="mail" title="Seguimiento de tu compra" description="Elige cualquier medio" />
    </section>
  </main>

  <!-- BANNER -->
  <div class="banner flex flex-col justify-center items-start">
    <div class="w-full flex justify-between p-4 sm:p-8 max-w-[1180px] m-auto">
      <h5 class="text-white sm:text-2xl text-balance">Hoy, tu seguridad al alcance de tus manos.</h5>
    </div>
  </div>

  <!-- FAQ -->
  <section id="faq" class="p-4 sm:p-8 max-w-[1180px] m-auto">
    <div class="my-2 sm:py-5 sm:w-[550px] lg:w-[600px] 2xl:w-[750px] ">
      <h2
        class="text-primary font-bold my-10 text-base sm:text-2xl 2xl:text-3xl"
      >
       Preguntas frecuentes. <span class="text-black font-normal">
        Si necesitas ayuda adicional, puedes ponerte en contacto con soporte.</span
        >
      </h2>
    </div>
    <Faq client:visible />
  </section>

  <script>
    import { check } from "@/store/cartStore";
    const token = document.cookie.split('=');

    if(token != null){
      check.set(token[1])
    }
  </script>

  <script is:inline>
    document.addEventListener('astro:page-load', () => {
      //Carrousel Slider
      const prevBtn = document.getElementById("prev");
      const nextBtn = document.getElementById("next");
      const slider = document.getElementById("promotions_slider");
      const arrItems = slider?.getAttribute("data-items");
  
      let current = 0;
      let translateXpercentage = current;
  
      const addOne = () => {
        if(arrItems != null){
          const total = parseInt(arrItems)
          if(!(current == total - 3)){
            current += 1;
          } 
        }
      };
      
      const removeOne = () => current >= 1 ? current -= 1 : null;
      const updatePercentaje = () => translateXpercentage = current * 3.7;
      
      const handlerClick = (e, action) => {
        e.preventDefault();
        action == 1 ? addOne() : removeOne();
        updatePercentaje();
        if(slider) slider.style.transform = `translateX(-${translateXpercentage}%)`;
      }
  
      prevBtn.addEventListener('click', (e) => handlerClick(e,0));
      nextBtn.addEventListener('click', (e) => handlerClick(e,1));
    })
  </script>
</Layout>


<style>
  .banner {
    background-image: url('/banner1.webp');
    background-size: cover;
    background-position: center;
    height: 300px;
    width: 100%;
  }
</style>
